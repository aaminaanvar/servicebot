(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[4],{2172:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="arrow-left",c=[],a="f060",s="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z";t.definition={prefix:"fas",iconName:n,icon:[448,512,c,a,s]},t.faArrowLeft=t.definition,t.prefix="fas",t.iconName=n,t.width=448,t.height=512,t.ligatures=c,t.unicode=a,t.svgPathData=s},2187:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return T}));var n=r(0),c=r(1),a=r(2051),s=r(2),o=r(25),l=r(14),i=r(6),u=r(2064),j=r(2022),d=r(2027),b=r(1050),f=r(2031),h=r(2025),x=r(543),O=r(2053),v=r(3),m=r(2172),p=r(542);function g(e){return Object(n.jsx)(j.a,Object(s.a)(Object(s.a)({variant:"icon",color:"neutral_8"},e),{},{children:Object(n.jsx)(p.a,{icon:m.faArrowLeft})}))}var w=r(59),y=r(15);function C(e,t){return[].concat(Object(y.a)(e?["read:any"]:[]),Object(y.a)(t?["create:any","update:any","delete:any"]:[]))}function R(e){var t=e.value,r=e.permission,c=e.onChange,a=t.includes("read:any"),s=t.includes("create:any");return Object(n.jsxs)(v.Flex,{py:3,children:[Object(n.jsx)(v.Box,{flex:4,width:4/6,children:Object(n.jsx)(x.a,{children:r.label})}),Object(n.jsx)(v.Box,{flex:1,width:1/6,children:!r.cannotView&&Object(n.jsx)("label",{children:Object(n.jsx)(h.a,{checked:a,onChange:function(){return c(C(!a,s))}})})}),Object(n.jsx)(v.Box,{flex:1,width:1/6,children:!r.cannotModify&&Object(n.jsx)("label",{children:Object(n.jsx)(h.a,{checked:s,onChange:function(){return c(C(a,!s))}})})})]})}function D(e){var t=e.value,r=e.onChange,c=e.permissions;return Object(n.jsxs)(v.Box,{children:[Object(n.jsxs)(v.Flex,{py:3,children:[Object(n.jsx)(v.Box,{flex:4,width:4/6,children:Object(n.jsx)(b.a,{variant:"h3",children:"Permissions"})}),Object(n.jsx)(v.Box,{flex:1,width:1/6,children:Object(n.jsx)(b.a,{variant:"h3",children:"View"})}),Object(n.jsx)(v.Box,{flex:1,width:1/6,children:Object(n.jsx)(b.a,{variant:"h3",children:"Modify"})})]}),c.map((function(e){return Object(n.jsx)(R,{permission:e,value:t[e.resource]||[],onChange:function(n){return r(Object(s.a)(Object(s.a)({},t),{},{[e.resource]:n}))}},e.resource)}))]})}var k,F=r(537),S=r(967);!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(k||(k={}));var U={role:"",description:"",is_default:!1,grants:{}};function B(e){var t=e.users,r=e.role,o=e.onSaveRole,l=e.onUpdateRole,m=e.onFetchUsers,p=e.permissions,y=Object(a.g)().push,C=c.useState(r||U),R=Object(i.a)(C,2),B=R[0],E=R[1],M=c.useState([]),_=Object(i.a)(M,2),A=_[0],L=_[1],q=c.useState(k.Users),P=Object(i.a)(q,2),G=P[0],N=P[1],K=c.useCallback((function(e){return E(Object(s.a)(Object(s.a)({},B),e))}),[B]);c.useEffect((function(){m({search:"",limit:0,offset:0})}),[m]),c.useEffect((function(){r&&E(r)}),[r]),c.useEffect((function(){L(Object.values(t).filter((function(e){return r&&-1!==e.roles.indexOf(r.role)})).map((function(e){return{label:e.username,value:e.username,data:e}})))}),[r,t,t.length]);var V=c.useMemo((function(){return Object.values(t).map((function(e){return{label:e.username,value:e.username,data:e}}))}),[t]);return Object(n.jsx)(u.a,{scrollable:!0,title:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(g,{onClick:function(){return y("/roles")}})," ",r?"Edit":"Create new"," ","Role"]}),rightContent:Object(n.jsxs)(v.Flex,{mr:-2,pr:4,flexDirection:"row-reverse",children:[Object(n.jsxs)(j.a,{variant:"primary",onClick:function(){var e=A.map((function(e){return e.data})),t=function(){y("/roles")},n=Object(s.a)(Object(s.a)({},B),{},{is_default:!!B.is_default});r?l({currentId:r.role,role:n,users:e,onSaved:t}):o({role:n,users:e,onSaved:t})},large:!0,mr:2,children:[r?"Save":"Create"," role"]}),Object(n.jsx)(j.a,{variant:"secondary",onClick:function(){return y("/roles")},large:!0,mr:2,children:r?"Cancel":"Discard"})]}),children:Object(n.jsxs)(v.Box,{width:2/3,m:"0 auto",children:[Object(n.jsxs)(d.a,{sx:{borderRadius:"large"},p:6,mb:6,children:[Object(n.jsx)(b.a,{variant:"h2",mb:4,children:"Basic Details"}),Object(n.jsx)(v.Box,{mb:4,width:"100%",children:Object(n.jsx)(w.a,{text:"Name",children:Object(n.jsx)(f.a,{value:B.role,onChangeValue:function(e){return K({role:e})},fullWidth:!0,placeholder:"Role title",autoFocus:!0})})}),Object(n.jsx)(v.Box,{mb:4,width:"100%",children:Object(n.jsx)(w.a,{text:"Description",children:Object(n.jsx)(f.a,{value:B.description||"",onChangeValue:function(e){return K({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"})})}),Object(n.jsxs)(v.Flex,{as:"label",alignItems:"center",children:[Object(n.jsx)(h.a,{checked:B.is_default||!1,onChange:function(e){return K({is_default:!B.is_default})},mr:2}),Object(n.jsx)(x.a,{children:"Set as default roles"})]})]}),Object(n.jsxs)(d.a,{sx:{borderRadius:"large"},p:6,children:[Object(n.jsxs)(S.a,{justifyContent:"flex-start",ml:-3,mb:4,children:[Object(n.jsx)(F.a,{variant:"h2",active:G===k.Permissions,onClick:function(){return N(k.Permissions)},children:"Add Permissions"}),Object(n.jsx)(F.a,{variant:"h2",active:G===k.Users,onClick:function(){return N(k.Users)},children:"Add Users"})]}),G===k.Permissions&&Object(n.jsx)(D,{permissions:p,value:B.grants,onChange:function(e){return K({grants:e})}}),G===k.Users&&Object(n.jsx)(w.a,{text:"Add users to this Role",children:Object(n.jsx)(O.a,{placeholder:"Search users...",items:V,onChange:function(e){L(Array.isArray(e)?e:[])},value:A})})]})]})})}var E=r(72),M=r(50),_={onSaveRole:E.f.request,onUpdateRole:E.g.request,onFetchUsers:M.c.request,onFetchRole:E.b.request,onFetchRoleUsers:E.c.request};var A=Object(l.b)((function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles}}),_)((function(e){var t=e.roles,r=e.onFetchRoleUsers,l=e.onFetchRole,i=Object(o.a)(e,["roles","onFetchRoleUsers","onFetchRole"]),u=Object(a.i)().params.roleName;c.useEffect((function(){u&&(l(u),r(u))}),[l,r,u]);var j=c.useMemo((function(){if(u)return Object.values(t).find((function(e){return e.role===u}))}),[u,t]);return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(B,Object(s.a)({role:j},i))})})),L=r(236),q=r(79),P=r(62),G=r(33),N=r(12),K=r(234),V=r(26);function I(e){var t=e.roles,r=e.users,a=e.total,s=e.onLoadMoreRows,o=e.onEdit,l=e.onDelete,i=c.useCallback((function(e){var t=e.dataSelected,r=e.setSelected,c=t.filter((function(e){return e.users_count&&e.users_count>0})).length;return Object(n.jsx)(v.Box,{children:Object(n.jsx)(G.a,{resource:N.d.Roles,action:N.a.Delete,yes:Object(n.jsx)(V.a,{content:c>0?"Cannot perform delete because ".concat(1===c?"the selected role still has":"".concat(c," selected roles still have")," users assigned"):"Delete",children:Object(n.jsx)(j.a,{variant:"inverse",disabled:c>0,onClick:function(){l(t),r([])},children:"Delete"})})})})}),[l]),u=c.useCallback((function(e){var t=e.selected,r=e.onChangeSelected;return function(e){var c=e.rowIndex,a=e.rowData,s=t.includes(c);return Object(n.jsxs)(v.Flex,{children:[Object(n.jsx)(v.Box,{flex:"0 1 auto",children:Object(n.jsx)("label",{children:Object(n.jsx)(h.a,{checked:s,onChange:function(){return r(c,!s)}})})}),Object(n.jsx)(v.Box,{ml:3,flex:"1",children:Object(n.jsx)(x.a,{variant:"bodySecondary",children:a.role})})]})}}),[]),d=c.useCallback((function(){return function(e){var t=e.rowData,c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return 0===c.length?Object(n.jsx)(x.a,{variant:"bodySecondary",children:"No users currently have this role"}):c.length<3?Object(n.jsx)(x.a,{variant:"bodySecondary",children:c.map((function(e){return e.username})).join(" and ")}):Object(n.jsxs)(x.a,{variant:"bodySecondary",children:[c.slice(0,2).map((function(e){return e.username})).join(", "),Object(n.jsxs)("b",{children:[" +",c.length-2," more"]})]})}}),[r]),b=c.useCallback((function(){return function(e){var t=e.rowData;if(!t)return null;var c=Object.values(r).filter((function(e){return-1!==e.roles.indexOf(t.role)}));return Object(n.jsxs)(v.Flex,{flexDirection:"row-reverse",mr:-1,children:[Object(n.jsx)(G.a,{resource:N.d.Roles,action:N.a.Delete,yes:0===c.length?Object(n.jsx)(V.a,{content:"Delete",children:Object(n.jsx)(j.a,{mx:1,onClick:function(){l([t])},variant:"icon",children:Object(n.jsx)(p.a,{icon:q.faTrashAlt})})}):Object(n.jsx)(v.Box,{mx:1,flex:"0 0 40px"})}),Object(n.jsx)(G.a,{resource:N.d.Roles,action:N.a.Update,yes:Object(n.jsx)(V.a,{content:"Edit",children:Object(n.jsx)(j.a,{mx:1,onClick:function(){o(t)},variant:"icon",children:Object(n.jsx)(p.a,{icon:L.faEdit})})})})]})}}),[r,o,l]);return Object(n.jsx)(K.a,{total:a,bulkActionsRenderer:i,data:t,resource:N.d.Roles,onLoadMoreRows:s,children:function(e){return[Object(n.jsx)(P.d,{cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:u(e)},"role"),Object(n.jsx)(P.d,{cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return Object(n.jsx)(x.a,{variant:"bodySecondary",children:t.description||"No description"})}},"description"),Object(n.jsx)(P.d,{cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:d()},"users"),Object(n.jsx)(P.d,{cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:b()},"role")]}})}function z(e){var t=e.roles,r=e.users,s=e.total,o=e.onLoadMoreRows,l=e.onFetchUsers,i=e.onDeleteRole,d=Object(a.g)().push,b=c.useCallback((function(e){return d("/roles/".concat(e.role))}),[d]);return c.useEffect((function(){o({search:"",offset:0,limit:0}),l({search:"",offset:0,limit:0})}),[o,l]),Object(n.jsx)(u.a,{title:"Roles",rightContent:Object(n.jsx)(j.a,{variant:"primary",large:!0,onClick:function(){return d("/roles/create")},mr:4,children:"Create new role"}),children:Object(n.jsx)(I,{roles:t,users:r,total:s,onLoadMoreRows:o,onEdit:b,onDelete:i})})}var H=r(18),J={onFetchUsers:M.c.request,onFetchRoles:E.d.request,onDeleteRole:E.a.request};var W=Object(l.b)((function(e){return{roles:e.roles.roles,users:e.users.users,total:e.roles.total,userRole:e.auth.role}}),J)((function(e){var t=Object(H.g)(E.d);return Object(n.jsx)(z,Object(s.a)(Object(s.a)({},e),{},{onLoadMoreRows:t}))}));function T(e){var t=Object(H.k)();c.useEffect((function(){t("view:roles:loaded")}),[t]);var r=Object(a.i)();return Object(n.jsxs)(a.e,{children:[Object(n.jsx)(a.c,{exact:!0,path:r.path,component:W}),Object(n.jsx)(a.c,{exact:!0,path:"".concat(r.path,"/create"),component:A}),Object(n.jsx)(a.c,{exact:!0,path:"".concat(r.path,"/:roleName"),component:A})]})}}}]);